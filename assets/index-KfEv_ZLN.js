(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const h of o.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}})();class g{constructor(e,t,i,n){this.x=e,this.y=t,this.width=i,this.height=n}draw(e){e.fillRect(this.x,this.y,this.width,this.height)}getBounds(){return this.padding,{startX:this.x,startY:this.y,endX:this.x+this.width,endY:this.y+this.height}}isColliding(e){const t=this.getBounds(),i=e.getBounds();return t.startX<i.endX&&t.endX>i.startX&&t.startY<i.endY&&t.endY>i.startY}}const j="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAoAAAACACAYAAACbUtgKAAAMq0lEQVR4Xu3dWa8kZRnA8fNRVEzc0EgMGo0oSyAaJbJHFIFhMYoCUXABERjZZRH0U3jjtesNRpQAigsKQZhhXwS/QsnbpsfxqVNdVV1LV9X7u/glJ3R3df3fpy+eOZwzs3f88ScVAADkYy/+BwAAls0CCACQGQsgAEBmLIAAAJmxAAIAZMYCCACQGQsgAEBm9k47fEcBAEA+LIAAAJmxAAIAZMYCCACQGQsgAEBmLIAAAJmxAAIAZMYCCACQmb0PPPqNAgCAfFgAAQAyYwEEAMiMBRAAIDMWQACAzFgAg+P+dG1xwpM3Fqceum31WzInP3NL8ZG/Xld6Hstk/nkz/7yZf95ym78F8Chp0OvBR+mD8MHHrim9huUw/7yZf97MP285zr/xAvjeh75evOOXlxRv+/nFxTG/urR4z+++VnrOnKXhx6FHS/0QNGH+5m/+5m/+5m/+5dfPVaMF8N2/vWI1+OhdD36l9Nw5ajL8JX8I6pi/+cfZm3/5Oktl/uYfZ2/+5evMUe0CmDb9OPijpQ9HfM2cfPgv3y0NuU76EMTrLJX5l5m/+cfrLJX5l5m/+cfrzNXGBfDYh68uDXw/x/7hqtJr5yD9wGfV//Ov87G/31C63tKYfzXzN/94vaUx/2rmb/7xenO0cQF814NfLQ17P3P9U8DH//H90mCbOvXQ7aXrLY35VzN/84/XWxrzr2b+5h+vN0cbF8Cq//cfzfUDcOLTB0uDbeO4P15buuaSmP9m5m/+8ZpLYv6bmb/5x2vOzcYFMH0L+O2/OFAaePT+t54XXzsHXT8AH3r826VrLon5b2b+5h+vuSTmv5n5m3+85txsXACTJf8QaJdvASdL+m2gKuZfzfzNP15zacy/mvmbf7zm3NQugEnVh2DufxdQ+iHQONSmTnjqptL1lsr8y8zf/OP1lsr8y8zf/OP15qjRApikYR/z68tWg09/EWT6iyHjc9p43++vLN75m8tW0tfx8bF89G/fKw23zinP3Lr68MRrtTGV/qbM3/zN3/zN3/zNfznzb7wA9mUdHv80scuDSL/SHYdcpevwp9g/pin2m/94pthv/uOZYr/5j2eK/TnPf7QFsCo82tVBNPkQdBn+1PuHNvV+8x/W1PvNf1hT7zf/YU29P9f5D74ANg2Pxj6IZNOHYNvhz6l/CHPqN//+zanf/Ps3p37z79+c+nOc/2AL4Lbh0VgHsZaG/Mmnbj7yN4Sf8uytqw9G29/4mWt/X+bab/79mGu/+fdjrv3m34+59uc2/94XwL7Co6EPoi/69evXH++/K/369euP79dVbwvgUOHRUAfRlX79+vXH++2bfv369cf331bnBXCs8Kjvg9iWfv369cf7G5p+/fr1x/tpa+sFsGv4GT+9oPjZPWevpK/j4031dRBt6devX3+8n6b069evf9f9rRfAvsKfvfFz/2fXB9GUfv369cf3b0q/fv36p9LfeAEcKjza1UHU0a9fv/74fk3p169ff+yNxu6vXQDHCo/GPogq+vXr1x+v35R+/fr1x746Y/VXLoC7Co/GOohIv379+uP1mtKvX7/+2NPW0P2lBXAq4dHQB6Ffv379+vXr1x9f39Tc+o8sgFMNj4Y6CP369euPz29Kv379+uP99q3v/r25hEd9HYR+/fr1x8eb0q9fv/54f0Prq38vPtDUrsKjrgexLf369euP9zM2/fr164/311TrBXAq4VHXg2hKv379+uP775p+/fr1x/ut03gBnGp4tO1B1NGvX7/++H5To1+/fv3x/qvULoBzCY/aHkQV/fr164/Xnzr9+vXrjz1R5QI41/Co6UFE+vXr1x+vNzf69evXH/vWSgvgUsKjuoPQr1+/fv369euPr5+7qv4jC+BSw6Oqg9CvX7/++Pyl0a9fv/51914u4dH6IPTr168/Pr50+vXr178XHwAAYNl2tgA+fcPpxVPXf7Z48rrPrL6Ojy+dfv369evXr19/fHwsoy2AKfTP15xaPHLVScVDV3xiX+mx9Jz03Pj6udOvX79+/fpjt379u+offAFMMY9efXIpts7DV55YPPGdT5euNzf69evXH/vq6NevX3+8Xt8GWwC3DY/GOoi+6devX3/saUu/fv364/X70vsC2Fd4NPRB9EW/fv364/13pV+/fv3x/brqbQEcKjwa6iC60q9fv/54v33Tr1+//vj+2+q8AI4VHvV9ENvSr1+//nh/Q9OvX7/+eD9tbb0A7io86usg2tKvX7/+eD9j069fv/54f021XgD7Cn/k6lOKx755WvH4tz61+jo+3lbXg2hKv379+uP7t6Vfv379u+5vvAB2DU+h/zx4TvHy3RcW//7Jl/eVHkvPSc+Nr29q24Ooo1+/fv3x/ZrSr1+//qn11y6AfYS/eNcFpdg6r913oHji+tNL12uq7UFU0a9fv/54/ab069evP/bVGau/cgHcVXjU9SDS366dWmJfHf369euP12tKv379+mNPW0P3lxbAqYRHXQ8iNW06CP369evXr1+//vj6pubWf2QBnGp4NNRB6NevX398flP69evXH++3b333780lPOrrIPTr168/Pt6Ufv369cf7G1pf/XvxgaZ2FR51PYht6devX3+8n7Hp169ff7y/plovgFMJj7oeRFP69evXH99/1/Tr168/3m+dxgvgVMOjbQ+ijn79+vXH95sa/fr164/3X6V2AZxLeNT2IKro169ff7z+1OnXr19/7IkqF8C5hkev3HPRqiX21dGvX7/+eL250a9fv/7Yt1ZaAJcSHqWmTQehX79+/fr169cfXz93Vf1HFsClhkdVB6Ffv3798flLo1+/fv3r7r1cwqP1QejXr19/fHzp9OvXr38vPkD/3vzx5cULt51XHLr5zJUXb/988cYDl5ae19Tr9x4onr/l3CPXS1+/eveFpecxDeafN/PPm/nnbcrztwAOLA3/8MGzSv/0TPpv23wIXr7zi6VrraXH4vPZLfPPm/nnzfzzNvX5WwAHlIb/3A/OLg3q6A/Bmw9cXnpdlU3D7/IhYBjmnzfzz5v5520O87cADih9qzcOKHrh1vNKr9tPk+Gvtf0QMAzzz5v558388zaH+VsABxQHs59DN51Rel3UZvhrbT4EDCPOZD/mv1xxJvsx/+WKM9mP+S9XnMl+dj1/C+CA0g9oxsFEdR+A9AOf8TVNvX7fxaXrMR7zz5v558388zaH+VsAB/TSneeXhhKlbxPH1x0t/YZPfE1T6bXxeozH/PNm/nkz/7zNYf4WwAH994dAzykNZi39gOgb92/+TaAmf4qoUvenC4Zl/nkz/7yZf97mMH8L4MCqPgRp+E1+A6jLByCJ12Nc5p8388+b+edt6vO3AI4gbfnpW72HbjpzJX3dZPhJl28BP3fw7NL1GJ/5583882b+eZvy/C2AE/favReVBtvUq3d/qXQ95sX882b+eTP/vA09fwvgDLx81xdKw62TvsUcr8M8mX/ezD9v5p+3IedvAZyJNh+Cpj9fwHyYf97MP2/mn7eh5m8BnJEmH4I2w2dezD9v5p8388/bEPO3AM7Mpg9B2+EzP+afN/PPm/nnre/573QBTL8iHf9bTrbtTz/cefRvBx2++azVByM+b+q27V+KbfvNfxm27Tf/Zdi23/yXYdv+Pue/kwUwhad/qy79HTeHD571VtCFpecsmX79+vXr169f/y77R10Ajw6P377c9UGMQb9+/fr169evfwr9oyyAm8KjXR3EkPTr169fv/7YG+nXP2b/oAtgm/Bo7IMYgn79+vXr1x/76ujXP0b/IAtgl/BofRBvPLD5H02eEv369evXrz/2tKVf/5D9vS6AfYZH6SDStYc6iD7o169fv3798f670q9/iP5eFsAhw6OhDqIL/fr169evP95v3/Tr77O/0wI4ZnjU90FsQ79+/fr164/3NzT9+vvo32oB3GV41NdBtKFfv379+vXH+xmbfv1d+lstgFMKj7oeRBP69evXr19/fP9d069/m/5GC+CUw6NtD2IT/fr169evP77f1OjX36Z/4wI4p/Co7UHsR79+/fr164/Xnzr9+pv077sAzjk8Sgfx0h3n1x6Efv369evXr19/Lv2rBfCN+y8rXr/3QPHKDy8onr/l3NJFliK1pcGm1n/96JJV99pr91yURX9qTP2pef0hMH/zN3/zz6Hf/M3f/P83/734JAAAls0CCACQGQsgAEBmLIAAAJmxAAIAZMYCCACQGQsgAEBmLIAAAJmxAAIAZMYCCACQmb3jjz+pAAAgHxZAAIDMWAABADJjAQQAyIwFEAAgMxZAAIDMWAABADJjAQQAyMx/ADa1EIUuCAPOAAAAAElFTkSuQmCC";class G extends g{ground;constructor(e,t){super(0,t-50,e,50),this.ground=new g(0,t-50,e,50),this.groundImg=new Image,this.groundImg.src=j}update(e){}draw(e){this.groundImg.complete&&this.groundImg.naturalWidth>0&&e.drawImage(this.groundImg,this.x,this.y,this.width,this.height)}setwidthheight(e,t){this.width=e,this.y=t-this.height,this.ground.width=e,this.ground.y=t-this.height}collideWith(e){return this.ground.isColliding(e)}}const H="/projet-gamejam-js/assets/toppillar-CyhbiW7i.png",O="/projet-gamejam-js/assets/bottompillar-uA56o8s3.png";class V extends g{topPipe;bottomPipe;topElement;bottomElement;constructor(e,t,i,n=150){super(e,0,35,t);const o=50,h=10;this.imageBottom=new Image,this.imageBottom.src=O,this.imageTop=new Image,this.imageTop.src=H,this.topPipe=new g(e+h,h,o-h*2,i-h),this.bottomPipe=new g(e+h,n+i+h,o-h*2,t-(n+i)-h),this.gapY=i,this.gapHeight=n,this.speed=2,this.passed=!1,this.createPipeElements(e,t),console.log("Pipe créé à x:",this.x)}createPipeElements(e,t){this.topElement=document.createElement("div"),this.topElement.className="pipe pipe-top",document.body.appendChild(this.topElement),this.bottomElement=document.createElement("div"),this.bottomElement.className="pipe pipe-bottom",document.body.appendChild(this.bottomElement),this.updatePipePositions()}updatePipePositions(){this.topElement.style.left=`${this.x}px`,this.topElement.style.top="0px",this.topElement.style.height=`${this.gapY}px`;const e=this.gapY+this.gapHeight;this.bottomElement.style.left=`${this.x}px`,this.bottomElement.style.top=`${e}px`,this.bottomElement.style.height=`${this.height-e}px`}update(e){const t=this.speed*e;this.x-=t,this.topPipe.x-=t,this.bottomPipe.x-=t,this.updatePipePositions()}draw(e){this.imageTop.complete&&this.imageTop.naturalWidth>0&&this.imageBottom.complete&&this.imageBottom.naturalWidth>0&&(e.drawImage(this.imageTop,this.topPipe.x,this.topPipe.y,this.topPipe.width,this.topPipe.height),e.drawImage(this.imageBottom,this.bottomPipe.x,this.bottomPipe.y,this.bottomPipe.width,this.bottomPipe.height))}isOffScreen(){const e=this.x+this.width<0;return e&&(console.log("Pipe hors écran à x:",this.x),this.destroy()),e}doesCollideWith(e){return this.topPipe.isColliding(e)&&console.log("Collide with top"),this.bottomPipe.isColliding(e)&&console.log("Collide with bottom"),this.topPipe.isColliding(e)||this.bottomPipe.isColliding(e)}destroy(){console.log("Destruction du pipe"),this.topElement&&this.topElement.parentNode&&this.topElement.parentNode.removeChild(this.topElement),this.bottomElement&&this.bottomElement.parentNode&&this.bottomElement.parentNode.removeChild(this.bottomElement)}}class D{constructor(e=100){this.currentValue=e,this.maxValue=e,this.containerName="app",this.createBarElement()}createBarElement(){const e=document.getElementById(this.containerName);if(!e)return console.error(`Conteneur #${this.containerName} introuvable !`);this.barContainer=document.createElement("div"),this.barContainer.className="mana-bar-container",this.barBackground=document.createElement("div"),this.barBackground.className="mana-bar-background",this.barFill=document.createElement("div"),this.barFill.className="mana-bar-fill",this.barFill.style.width="100%",this.barBackground.appendChild(this.barFill),this.barContainer.appendChild(this.barBackground),e.appendChild(this.barContainer)}setValue(e){this.currentValue=Math.max(0,Math.min(e,this.maxValue));const i=100-this.currentValue/this.maxValue*100;this.barFill.style.width=i+"%"}getManaValue(){return this.currentValue}update(e){if(e)this.currentValue<this.maxValue&&this.setValue(this.currentValue+.2);else{let i=this.currentValue-.2;i<=0&&(console.error("Mana épuisé !"),i=0),this.setValue(i)}}hide(){this.barContainer&&(this.barContainer.style.display="none")}show(){this.barContainer&&(this.barContainer.style.display="block")}}const k="/projet-gamejam-js/assets/flappyDuck-RXc2M-Fj.png";class F extends g{constructor(e,t){super(e,t,60,47),this.velocity=0,this.gravity=-.25,this.jumpStrength=5.5,this.image=new Image,this.image.src=k}update(){this.velocity+=this.gravity,this.y+=this.velocity}jump(){this.velocity=this.jumpStrength}draw(e){this.image.complete&&this.image.naturalWidth>0?this.gravity<0?(e.save(),e.translate(this.x+this.width/2,this.y+this.height/2),e.scale(1,-1),e.drawImage(this.image,-this.width/2,-this.height/2,this.width,this.height),e.restore()):e.drawImage(this.image,this.x,this.y,this.width,this.height):super.draw(e)}getBounds(){return{startX:this.x+11,startY:this.y+7,endX:this.x+this.width,endY:this.y+this.height}}isFalling(){return this.gravity<0?this.velocity<0:this.velocity>0}setGravityMode(e){e?(this.gravity=-.25,this.jumpStrength=5.5):(this.gravity=.25,this.jumpStrength=-5.5)}}class Y{constructor(){this.sounds={},this.loops={},this.muted=!1}loadSound(e,t){return new Promise((i,n)=>{const o=new Audio(t);o.preload="auto",o.addEventListener("canplaythrough",()=>{this.sounds[e]=o,console.log(`Son "${e}" préchargé ✓`),i()},{once:!0}),o.addEventListener("error",h=>{console.error(`Erreur de chargement du son "${e}":`,h),n(h)}),o.load()})}stopAll(){for(const e of Object.values(this.loops))e.pause(),e.currentTime=0}play(e,t=1){if(this.muted||!this.sounds[e])return;const i=this.sounds[e].cloneNode();i.volume=t,console.log("Lecture du son:",e);const n=performance.now();i.play().then(()=>{const o=performance.now()-n;console.log(`Son "${e}" joué en ${o.toFixed(2)} ms ✓`)}).catch(o=>console.log("Erreur audio:",o))}playLoop(e,t=1){if(this.muted||!this.sounds[e])return;this.stopAll();const i=this.sounds[e];i.loop=!0,i.volume=t,console.log("Lecture en boucle du son:",e);const n=performance.now();i.play().then(()=>console.log("Musique lancée")).then(()=>{const o=performance.now()-n;console.log(`Son "${e}" joué en boucle en ${o.toFixed(2)} ms ✓`)}).catch(o=>console.log("Erreur audio:",o)),this.loops[e]=i}stop(e){if(!this.loops[e])return;const t=this.loops[e];t.pause(),t.currentTime=0,delete this.loops[e]}isLoopPlaying(e){return this.loops[e]&&!this.loops[e].paused}}class R extends g{sky;constructor(e,t){super(0,t,e,0),this.sky=new g(0,0,e,1)}setwidthheight(e,t){this.width=e,this.sky.width=e}collidingWith(e){return this.sky.isColliding(e),this.sky.isColliding(e)}}class Q{constructor(){this.pauseBtn=document.getElementById("pause-btn"),this.startControls=document.getElementById("start-controls"),this.rules=document.getElementById("rules"),this.closeBtn=document.getElementById("close-btn"),this.pseudoDisplay=document.getElementById("player-pseudo"),this.srAnnouncements=document.getElementById("sr-announcements"),this.focusTrapCleanup=null,this.closeBtn&&this.rules&&this.closeBtn.addEventListener("click",()=>{this.hideRules()}),this.rules&&!this.rules.classList.contains("hidden")&&(this.focusTrapCleanup=this.setupFocusTrap(this.rules)),this.btnGravityNormal=document.getElementById("btn-gravity-normal"),this.btnGravityInverted=document.getElementById("btn-gravity-inverted")}updateGravityButtons(e){e?(this.btnGravityInverted.classList.add("selected"),this.btnGravityNormal.classList.remove("selected")):(this.btnGravityNormal.classList.add("selected"),this.btnGravityInverted.classList.remove("selected"))}announce(e){this.srAnnouncements&&(this.srAnnouncements.textContent=e,setTimeout(()=>{this.srAnnouncements.textContent=""},1e3))}updateDOM(e,t,i=null){e===t.start?(this.pauseBtn.classList.add("hidden"),this.startControls.classList.remove("hidden"),i&&i.hide()):e===t.playing?(this.pauseBtn.classList.remove("hidden"),this.pauseBtn.textContent="⏸️",this.pauseBtn.setAttribute("aria-label","Mettre le jeu en pause"),this.startControls.classList.add("hidden"),i&&i.show()):e===t.paused?(this.pauseBtn.classList.remove("hidden"),this.pauseBtn.textContent="▶️",this.pauseBtn.setAttribute("aria-label","Reprendre le jeu"),this.startControls.classList.add("hidden"),i&&i.show()):(this.pauseBtn.classList.add("hidden"),this.startControls.classList.add("hidden"),i&&i.show())}drawStartScreen(e,t){e.fillStyle="#0f5f0f",e.font="30px Arial",e.textAlign="center",e.fillText("FLAPPY DUCK",t.width/2,t.height/2-150),e.font="20px Arial",e.fillText("Appuyez sur Espace",t.width/2,t.height/2-50),e.fillText(" ou clic pour commencer",t.width/2,t.height/2),e.fillText("Dernier score : "+(localStorage.getItem("lastScore")??0),t.width/2,t.height/2+50),e.fillText("Meilleur score : "+(localStorage.getItem("bestScore")??0),t.width/2,t.height/2+100)}drawPauseScreen(e,t,i,n){e.fillStyle="rgba(0, 0, 0, 0.5)",e.fillRect(0,0,t.width,t.height),e.fillStyle="white",e.font="20px Arial",e.textAlign="center",e.fillText("PAUSE",t.width/2,t.height/2),e.fillText("Score actuel : "+i,t.width/2,t.height/2+50);let o=n?"Inversée":"Normale";e.fillText("Gravité : "+o,t.width/2,t.height/2+100)}drawGameOverScreen(e,t,i){e.fillStyle="rgba(0, 0, 0, 0.7)",e.fillRect(0,0,t.width,t.height),e.fillStyle="white",e.textAlign="center",e.font="20px Arial",e.fillText("PERDU !",t.width/2,t.height/2-20),e.fillText("Score final : "+i,t.width/2,t.height/2+20),e.fillText("Appuyez sur espace pour rejouer",t.width/2,t.height/2+60)}drawScore(e,t,i){e.font="bold 50px Arial",e.textAlign="center",e.strokeStyle="#101010",e.lineWidth=4,e.strokeText(i,t.width/2,120),e.fillStyle="#EE5A29",e.fillText(i,t.width/2,120)}hideRules(){this.rules&&(this.rules.classList.add("hidden"),this.focusTrapCleanup&&(this.focusTrapCleanup(),this.focusTrapCleanup=null))}isRulesVisible(){return this.rules&&!this.rules.classList.contains("hidden")}setPlayerName(e){this.pseudoDisplay&&(this.pseudoDisplay.textContent=e)}setupFocusTrap(e){if(!e)return;const t=e.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(t.length===0)return;const i=t[0],n=t[t.length-1];i.focus();const o=h=>{h.key==="Tab"&&(h.shiftKey?document.activeElement===i&&(h.preventDefault(),n.focus()):document.activeElement===n&&(h.preventDefault(),i.focus()))};return e.addEventListener("keydown",o),()=>{e.removeEventListener("keydown",o)}}}const u=new Y;async function q(){console.log("Préchargement des sons..."),await Promise.all([u.loadSound("music","src/assets/sounds/music_fixed.mp3"),u.loadSound("jump","src/assets/sounds/jump.mp3"),u.loadSound("pause","src/assets/sounds/pause_music.mp3"),u.loadSound("gameOver","src/assets/sounds/loose_music.mp3")]),console.log("Tous les sons sont préchargés !")}q().catch(s=>console.error("Erreur préchargement sons:",s));let y=1,m=0,x=0,b=0;const U=240;let c=0,f=0;const l=document.createElement("canvas"),p=l.getContext("2d");l.setAttribute("role","img");l.setAttribute("aria-label","Zone de jeu Flappy Duck - Évitez les obstacles en contrôlant le canard avec la barre d'espace ou la souris");document.querySelector("#app").appendChild(l);const X=600,L=()=>X*(window.innerWidth/window.innerHeight);l.height=X;l.width=L();window.addEventListener("resize",()=>{l.height=X,l.width=L(),typeof v<"u"&&v.setwidthheight(l.width,l.height),typeof C<"u"&&C.setwidthheight(l.width,l.height)});const a={start:0,playing:1,paused:2,gameOver:3},v=new G(l.width,l.height),P=new D,d=new F(50,300),C=new R(l.width,l.height),r=new Q;let A=[],B=0;d.setGravityMode(!0);r.updateGravityButtons(!0);let N=0;const z=document.getElementById("btn-gravity-normal"),I=document.getElementById("btn-gravity-inverted");function w(){r.updateDOM(c,a,P)}r.pauseBtn.addEventListener("click",s=>{s.stopPropagation(),r.pauseBtn.blur(),c===a.playing?(c=a.paused,r.announce("Jeu en pause")):c===a.paused&&(c=a.playing,r.announce("Jeu repris")),w()});r.pauseBtn.addEventListener("mousedown",s=>s.stopPropagation());z.addEventListener("click",s=>{s.stopPropagation(),console.log("Mode gravité normale activé (Bouton)"),d.setGravityMode(!1),r.updateGravityButtons(!1),r.announce("Gravité normale sélectionnée"),d.y=300});z.addEventListener("mousedown",s=>s.stopPropagation());I.addEventListener("click",s=>{s.stopPropagation(),console.log("Mode gravité inversée activé (Bouton)"),d.setGravityMode(!0),r.updateGravityButtons(!0),r.announce("Gravité inversée sélectionnée"),d.y=300});I.addEventListener("mousedown",s=>s.stopPropagation());let E=localStorage.getItem("playerName");E||(E=prompt("Entrez votre pseudo :")||"Mets toi un pseudo",localStorage.setItem("playerName",E));r.setPlayerName(E);function M(s){if(s.key==="Escape"){c===a.playing?(c=a.paused,r.announce("Jeu en pause")):c===a.paused&&(c=a.playing,r.announce("Jeu repris")),w();return}if(r.isRulesVisible()){(s.code==="Space"||s.code==="Enter"||s.type==="mousedown"||s.type==="click")&&r.hideRules();return}if(s.code==="Space"||s.type==="click"||s.type==="mousedown")switch(c){case a.start:c=a.playing,r.announce("Jeu démarré"),w();break;case a.playing:if(P.getManaValue()>10){const e=Date.now();d.jump(),e-B>=200&&(P.update(!1),B=e,u.play("jump",.1))}break;case a.gameOver:K(),r.announce("Nouvelle partie");break}c===a.start&&(s.key==="1"?(console.log("Mode gravité inversée activé"),d.setGravityMode(!0),r.updateGravityButtons(!0),r.announce("Gravité inversée sélectionnée"),d.y=300):(s.key==="0"||s.key==="2")&&(console.log("Mode gravité normale activé"),d.setGravityMode(!1),r.updateGravityButtons(!1),r.announce("Gravité normale sélectionnée"),d.y=300))}window.addEventListener("keydown",M);window.addEventListener("mousedown",M);function Z(){c===a.playing&&f!==1&&(u.stop("pause"),u.stop("gameOver"),u.isLoopPlaying("music")||(u.playLoop("music",.3),console.log("Musique de fond démarrée !")),f=1),c===a.paused&&f!==2&&(u.stop("music"),u.stop("gameOver"),u.isLoopPlaying("pause")||(u.playLoop("pause",.3),console.log("Musique de pause démarrée !")),f=2),c===a.gameOver&&f!==3&&(u.stop("music"),u.stop("pause"),u.isLoopPlaying("gameOver")||(u.playLoop("gameOver",.3),console.log("Musique game over démarrée !")),f=3),c===a.start&&f!==0&&(u.stop("music"),u.stop("pause"),u.stop("gameOver"),f=0)}function T(){switch(p.clearRect(0,0,l.width,l.height),Z(),c){case a.start:v.draw(p),r.drawStartScreen(p,l);break;case a.playing:W();break;case a.paused:A.forEach(s=>s.draw(p)),v.draw(p),d.draw(p),r.drawPauseScreen(p,l,m,d.gravity<0);break;case a.gameOver:A.forEach(s=>s.draw(p)),v.draw(p),d.draw(p),r.drawGameOverScreen(p,l,m);break}requestAnimationFrame(T)}function W(){if(P.update(d.isFalling()),N-=1,document.body.style.backgroundPosition=`${N}px 0`,d.update(),v.update(y),x++,x%600===0&&(y=Math.min(y+.1,4),console.log(`Vitesse augmentée: ${y.toFixed(1)}x`)),b+=2*y,b>=U){const e=l.height-200,t=Math.floor(Math.random()*(e-50))+50;A.push(new V(l.width+50,l.height,t)),b=0}A=A.filter(s=>(s.update(y),s.draw(p),!s.passed&&d.x>s.x+s.width&&(s.passed=!0,m++,console.log("Score:",m)),s.doesCollideWith(d)&&(c=a.gameOver,S(m),r.announce(`Perdu ! Score final : ${m}`),w()),!s.isOffScreen())),v.draw(p),d.draw(p),(v.collideWith(d)||C.collidingWith(d))&&(c=a.gameOver,S(m),r.announce(`Perdu ! Score final : ${m}`),w()),r.drawScore(p,l,m)}function S(s){localStorage.setItem("lastScore",s),(localStorage.getItem("bestScore")===null||s>parseInt(localStorage.getItem("bestScore")))&&localStorage.setItem("bestScore",s)}function K(){A.forEach(s=>s.destroy()),d.y=300,d.velocity=0,A=[],y=1,m=0,b=0,P.setValue(100),c=a.start,w()}T();w();
